<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="refresh" content="1800">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>Relatório_Clientes - Power Portal</title>
  <!-- <link rel="shortcut icon" href="https://www.powerportal.com.br/img/favicon.png">  -->
  <style>
    body { margin:0; padding:0; background-color:#FFFFFF; }
    .iframe-container { position:relative; width:100vw; height:100vh; overflow:hidden; }
    .iframe-container iframe { position:absolute; top:0; left:0; width:100%; height:100%; border:none; transition:opacity .5s ease; opacity:0; z-index:1; }
    .iframe-container iframe.active { opacity:1; z-index:2; }
    .ajuste { margin-top:-5px; margin-left:-8px; width:101% !important; height:109vh !important; border:none; }
    #controls-wrapper { position:fixed; bottom:10px; left:10px; z-index:9999; display:flex; flex-direction:column; align-items:flex-start; }
    #controls-container { display:flex; align-items:center; opacity:.6; transition:opacity .3s ease; }
    #controls-container.hidden { opacity:0; pointer-events:none; }
    .control-btn { width:40px; height:40px; background:rgba(0,0,0,.3); border:none; border-radius:50%; display:flex; align-items:center; justify-content:center; cursor:pointer; margin:0 4px; }
    .control-btn svg { fill:#fff; width:20px; height:20px; }
    select { background:rgba(0,0,0,.3); color:#fff; border:none; border-radius:5px; padding:4px 6px; margin-left:6px; font-size:14px; cursor:pointer; }
    #progressBar { width:calc(40px * 3 + 8px * 2); height:8px; background:rgba(255,255,255,.3); border-radius:4px; overflow:hidden; margin-top:6px; }
    #progressFill { height:100%; width:0%; background:rgba(0,255,0,.5); transition:width .1s linear; }
    /* animações (mantidas) */
    .fade { animation:fade 1s; } @keyframes fade { from{opacity:.4} to{opacity:1} }
    .scale-up-center{animation:scale-up-center 1s cubic-bezier(.39,.575,.565,1) both}@keyframes scale-up-center{0%{transform:scale(.5)}100%{transform:scale(1)}}
    .scale-down-center{animation:scale-down-center 1s cubic-bezier(.25,.46,.45,.94) both}@keyframes scale-down-center{0%{transform:scale(1.8)}100%{transform:scale(1)}}
    .rotate-center-right{animation:rotate-center-right 1s ease-in-out both}@keyframes rotate-center-right{0%{transform:rotate(180deg)}100%{transform:rotate(360deg)}}
    .rotate-center-left{animation:rotate-center-left 1s ease-in-out both}@keyframes rotate-center-left{0%{transform:rotate(-180deg)}100%{transform:rotate(-360deg)}}
    .rotate-scale-up{animation:rotate-scale-up 1s linear both}@keyframes rotate-scale-up{0%{transform:scale(1) rotateZ(180deg)}50%{transform:scale(1.5) rotateZ(270deg)}100%{transform:scale(1) rotateZ(360deg)}}
    .rotate-scale-down{animation:rotate-scale-down 1s linear both}@keyframes rotate-scale-down{0%{transform:scale(1) rotateZ(180deg)}50%{transform:scale(.5) rotateZ(270deg)}100%{transform:scale(1) rotateZ(360deg)}}
    .flip-bottom{animation:flip-bottom 1s cubic-bezier(.455,.03,.515,.955) both}@keyframes flip-bottom{0%{transform:rotateX(-180deg)}100%{transform:rotateX(0)}}
    .flip-top{animation:flip-top 1s cubic-bezier(.455,.03,.515,.955) both}@keyframes flip-top{0%{transform:rotateX(180deg)}100%{transform:rotateX(0)}}
    .flip-right{animation:flip-right 1s cubic-bezier(.455,.03,.515,.955) both}@keyframes flip-right{0%{transform:rotateY(180deg)}100%{transform:rotateY(0)}}
    .flip-left{animation:flip-left 1s cubic-bezier(.455,.03,.515,.955) both}@keyframes flip-left{0%{transform:rotateY(-180deg)}100%{transform:rotateY(0)}}
    .slide-top{animation:slide-top 1s cubic-bezier(.25,.46,.45,.94) both}@keyframes slide-top{0%{transform:translateY(400px)}100%{transform:translateY(0)}}
    .slide-bottom{animation:slide-bottom 1s cubic-bezier(.25,.46,.45,.94) both}@keyframes slide-bottom{0%{transform:translateY(-400px)}100%{transform:translateY(0)}}
    .slide-right{animation:slide-right 1s cubic-bezier(.25,.46,.45,.94) both}@keyframes slide-right{0%{transform:translateX(-400px)}100%{transform:translateX(0)}}
    .slide-left{animation:slide-left 1s cubic-bezier(.25,.46,.45,.94) both}@keyframes slide-left{0%{transform:translateX(400px)}100%{transform:translateX(0)}}
    .scale-up-hor-center{animation:scale-up-hor-center 1s cubic-bezier(.39,.575,.565,1) both}@keyframes scale-up-hor-center{0%{transform:scaleX(.4)}100%{transform:scaleX(1)}}
    .scale-down-hor-center{animation:scale-down-hor-center 1s cubic-bezier(.25,.46,.45,.94) both}@keyframes scale-down-hor-center{0%{transform:scaleX(1.4)}100%{transform:scaleX(1)}}
    .flip-scale-up-ver{animation:flip-scale-up-ver 1s linear both}@keyframes flip-scale-up-ver{0%{transform:scale(1) rotateY(180deg)}50%{transform:scale(2.5) rotateY(90deg)}100%{transform:scale(1) rotateY(0)}}
    .flip-scale-up-hor{animation:flip-scale-up-hor 1s linear both}@keyframes flip-scale-up-hor{0%{transform:scale(1) rotateX(-180deg)}50%{transform:scale(2.5) rotateX(-90deg)}100%{transform:scale(1) rotateX(0)}}
    .rotate-90-left{animation:rotate-90-left 1s cubic-bezier(.25,.46,.45,.94) both}@keyframes rotate-90-left{0%{transform:rotate(90deg);transform-origin:bottom}100%{transform:rotate(0);transform-origin:bottom}}
    .rotate-90-right{animation:rotate-90-right 1s cubic-bezier(.25,.46,.45,.94) both}@keyframes rotate-90-right{0%{transform:rotate(-90deg);transform-origin:bottom}100%{transform:rotate(0);transform-origin:bottom}}
    .roll-in-left{animation:roll-in-left 1s ease-out both}@keyframes roll-in-left{0%{transform:translateX(-800px) rotate(-540deg);opacity:0}100%{transform:translateX(0) rotate(0);opacity:1}}
    .roll-in-right{animation:roll-in-right 1s ease-out both}@keyframes roll-in-right{0%{transform:translateX(800px) rotate(540deg);opacity:0}100%{transform:translateX(0) rotate(0);opacity:1}}
    .jello{animation:jello 1s both}@keyframes jello{0%{transform:scale3d(1,1,1)}30%{transform:scale3d(1.25,.75,1)}40%{transform:scale3d(.75,1.25,1)}50%{transform:scale3d(1.15,.85,1)}65%{transform:scale3d(.95,1.05,1)}75%{transform:scale3d(1.05,.95,1)}100%{transform:scale3d(1,1,1)}}
    @media only screen and (max-width: 100%) { .text { font-size:11px; } }
    .none{display:none}
  </style>
</head>
<body>
  <div class="iframe-container">
    <iframe id="powerbi-frame-1" class="ajuste" src="" allowfullscreen="true"></iframe>
    <iframe id="powerbi-frame-2" class="ajuste active" src="https://app.powerbi.com/reportEmbed?reportId=378ee982-992b-4394-935f-7fe72b82c16a&amp;autoAuth=true&amp;ctid=2d79ce37-f781-44a3-8ba0-53c48bdba8e8&amp;pageName=ReportSection8b18ae8bc153d10b280d" allowfullscreen="true"></iframe>
  </div>

  <div id="controls-wrapper">
    <div id="controls-container" class="hidden">
      <button id="prevBtn" class="control-btn" title="Anterior">
        <svg viewBox="0 0 24 24"><polygon points="11,12 18,18 18,6"></polygon><polygon points="6,12 13,18 13,6"></polygon></svg>
      </button>
      <button id="playPauseBtn" class="control-btn" title="Parar/Retomar">
        <svg id="pauseIcon" viewBox="0 0 24 24"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>
        <svg id="playIcon" viewBox="0 0 24 24" style="display:none;"><polygon points="8,5 19,12 8,19"></polygon></svg>
      </button>
      <button id="nextBtn" class="control-btn" title="Próximo">
        <svg viewBox="0 0 24 24"><polygon points="6,6 6,18 13,12"></polygon><polygon points="11,6 11,18 18,12"></polygon></svg>
      </button>
      <select id="interval-selector" title="Tempo (segundos)">
        <option value="5">5s</option>
        <option value="10">10s</option>
        <option value="15">15s</option>
        <option value="20">20s</option>
        <option value="30">30s</option>
        <option value="45">45s</option>
        <option value="60">1min</option>
        <option value="1800" selected>30min</option>
      </select>
      <select id="effect-selector" title="Transição">
        <option value="nenhum" selected>Nenhum</option>
        <option value="fade">Fade</option>
        <option value="scale-up-center">Scale Up</option>
        <option value="scale-down-center">Scale Down</option>
        <option value="scale-up-hor-center">Scale Up Center</option>
        <option value="scale-down-hor-center">Scale Down Center</option>
        <option value="jello">Jello</option>
        <option value="rotate-center-left">Rotate Left</option>
        <option value="rotate-center-right">Rotate Right</option>
        <option value="rotate-90-left">Rotate 90° Left</option>
        <option value="rotate-90-right">Rotate 90° Right</option>
        <option value="rotate-scale-up">Rotate Scale Up</option>
        <option value="rotate-scale-down">Rotate Scale Down</option>
        <option value="roll-in-left">Roll In Left</option>
        <option value="roll-in-right">Roll In Right</option>
        <option value="flip-top">Flip Top</option>
        <option value="flip-bottom">Flip Bottom</option>
        <option value="flip-left">Flip Left</option>
        <option value="flip-right">Flip Right</option>
        <option value="flip-scale-up-ver">Flip Scale Up Vertical</option>
        <option value="flip-scale-up-hor">Flip Scale Up Horizontal</option>
        <option value="slide-top">Slide Top</option>
        <option value="slide-bottom">Slide Bottom</option>
        <option value="slide-left">Slide Left</option>
        <option value="slide-right">Slide Right</option>
      </select>
    </div>
    <div id="progressBar"><div id="progressFill" style="width:0%"></div></div>
  </div>

  <script>
    // URLs (removido espaço extra)
    const urls = [
      "https://app.powerbi.com/reportEmbed?reportId=378ee982-992b-4394-935f-7fe72b82c16a&autoAuth=true&ctid=2d79ce37-f781-44a3-8ba0-53c48bdba8e8&pageName=ReportSectionc57054a27726e0fd0397",
      "https://app.powerbi.com/reportEmbed?reportId=378ee982-992b-4394-935f-7fe72b82c16a&autoAuth=true&ctid=2d79ce37-f781-44a3-8ba0-53c48bdba8e8&pageName=ReportSection8b18ae8bc153d10b280d"
    ];

    let curr = 0;
    let isPaused = false;
    let timer;
    let progressInterval;
    let transitionEffect = "nenhum";
    let activeFrame = 1;

    const iframe1 = document.getElementById("powerbi-frame-1");
    const iframe2 = document.getElementById("powerbi-frame-2");

    const playPauseBtn = document.getElementById("playPauseBtn");
    const pauseIcon = document.getElementById("pauseIcon");
    const playIcon = document.getElementById("playIcon");
    const progressFill = document.getElementById("progressFill");
    const controlsContainer = document.getElementById("controls-container");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const intervalSelector = document.getElementById("interval-selector");
    const effectSelector = document.getElementById("effect-selector");

    // === usar o valor do seletor como duração inicial (30min por padrão) ===
    let panelDuration = parseInt(intervalSelector.value, 10) * 1000;

    intervalSelector.addEventListener("change", () => {
      panelDuration = parseInt(intervalSelector.value, 10) * 1000;
      if (!isPaused) {
        clearTimeout(timer);
        clearInterval(progressInterval);
        showPanel();
      }
    });

    playPauseBtn.addEventListener("click", () => {
      isPaused = !isPaused;
      pauseIcon.style.display = isPaused ? "none" : "block";
      playIcon.style.display = isPaused ? "block" : "none";
      if (isPaused) {
        clearTimeout(timer);
        clearInterval(progressInterval);
      } else {
        showPanel();
      }
    });

    prevBtn.addEventListener("click", () => {
      clearTimeout(timer);
      clearInterval(progressInterval);
      curr = (curr - 1 + urls.length) % urls.length;
      showPanel();
    });

    nextBtn.addEventListener("click", () => {
      clearTimeout(timer);
      clearInterval(progressInterval);
      curr = (curr + 1) % urls.length;
      showPanel();
    });

    effectSelector.addEventListener("change", () => {
      transitionEffect = effectSelector.value;
    });

    function showPanel() {
      const currentFrame = activeFrame === 1 ? iframe1 : iframe2;
      const nextFrame = activeFrame === 1 ? iframe2 : iframe1;

      // limpa efeitos e prepara próximo
      currentFrame.className = "ajuste";
      nextFrame.className = "ajuste";

      nextFrame.src = urls[(curr + 1) % urls.length];

      // efeito + troca
      if (transitionEffect && transitionEffect !== "nenhum") {
        nextFrame.classList.add(transitionEffect);
      }
      nextFrame.classList.add("active");
      currentFrame.classList.remove("active");

      if (!isPaused) {
        let start = Date.now();
        progressFill.style.width = "0%";
        clearInterval(progressInterval);
        progressInterval = setInterval(() => {
          const elapsed = Date.now() - start;
          const percent = Math.min((elapsed / panelDuration) * 100, 100);
          progressFill.style.width = percent + "%";
        }, 100);

        clearTimeout(timer);
        timer = setTimeout(() => {
          clearInterval(progressInterval);
          curr = (curr + 1) % urls.length;
          activeFrame = activeFrame === 1 ? 2 : 1;
          showPanel();
        }, panelDuration);
      }
    }

    // Mostrar/ocultar controles por inatividade
    let inactivityTimeout;
    function resetInactivityTimer() {
      controlsContainer.classList.remove("hidden");
      clearTimeout(inactivityTimeout);
      inactivityTimeout = setTimeout(() => {
        controlsContainer.classList.add("hidden");
      }, 5000);
    }
    document.addEventListener("mousemove", resetInactivityTimer);
    document.addEventListener("keydown", resetInactivityTimer);
    resetInactivityTimer();

    // === Anti-soneca: Wake Lock + fallback com vídeo mudo ===
    let wakeLock;
    async function requestWakeLock() {
      try {
        if ('wakeLock' in navigator) {
          wakeLock = await navigator.wakeLock.request('screen');
          wakeLock.addEventListener('release', () => {
            // tenta reaquisição se liberar
            tryRequestOnVisibility();
          });
        }
      } catch (e) {
        // ignora erros silenciados (ex.: não suportado)
      }
    }
    function tryRequestOnVisibility() {
      if (document.visibilityState === 'visible') requestWakeLock();
    }
    document.addEventListener('visibilitychange', tryRequestOnVisibility);

    function startKeepAwakeVideo() {
      // usa um MP4 curto e silencioso hospedado junto do site (1–2s) em loop
      const v = document.createElement('video');
      v.autoplay = true;
      v.loop = true;
      v.muted = true;
      v.playsInline = true;
      v.src = '/keep-awake.mp4';
      v.style.cssText = 'position:fixed;left:0;top:0;width:1px;height:1px;opacity:0;pointer-events:none;z-index:-1';
      document.body.appendChild(v);
      // algumas TVs exigem interação — tentamos mesmo assim
      v.play().catch(() => { /* sem estresse */ });
    }

    window.addEventListener('load', () => {
      showPanel();
      requestWakeLock();      // tenta manter a tela ativa (quando suportado)
      startKeepAwakeVideo();  // fallback universal para TVs
    });

    // se o autoplay bloquear, a primeira interação do usuário tenta novamente
    ['click','keydown'].forEach(evt => {
      window.addEventListener(evt, () => {
        requestWakeLock();
      }, { once: false });
    });
  </script>
</body>
</html>
